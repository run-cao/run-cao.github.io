(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{496:function(s,t,a){"use strict";a.r(t);var e=a(62),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"docker-mysql"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#docker-mysql"}},[s._v("#")]),s._v(" Docker MySQL")]),s._v(" "),a("p",[s._v("MySQL 的 Docker 镜像在 dockerhub 上的地址："),a("a",{attrs:{href:"https://hub.docker.com/_/mysql",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://hub.docker.com/_/mysql"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("当前"),a("small",[s._v("（2021-04-02）")]),s._v("的 "),a("strong",[s._v("latest")]),s._v(" 和 "),a("strong",[s._v("8.0.23")]),s._v(" 是同一个镜像 。另外，"),a("strong",[s._v("5.7")]),s._v(" 版本和 "),a("strong",[s._v("5.7.33")]),s._v(" 是同一个镜像。")]),s._v(" "),a("h2",{attrs:{id:"_1-安装及测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-安装及测试"}},[s._v("#")]),s._v(" 1. 安装及测试")]),s._v(" "),a("ul",[a("li",[s._v("搜索、拉取镜像：")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查询中央仓库")]),s._v("\ndocker search -f is-official"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true mysql\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从中央仓库下载")]),s._v("\ndocker pull mysql:8.0.16\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或，直接导入已有的镜像文件")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load -i mysql-8.0.16.tar")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看本地镜像")]),s._v("\ndocker images\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会出现类似如下内容：")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# REPOSITORY      TAG       IMAGE ID       CREATED        SIZE")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql           8.0.16    de764ad211de   2 years ago    443MB")]),s._v("\n")])])]),a("ul",[a("li",[s._v("创建、运行容器：")])]),s._v(" "),a("el-tabs",[a("el-tab-pane",{attrs:{label:"语法"}},[a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除曾经已有的同名容器 ")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("容器名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建并运行 mysql 容器的语法")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("指定容器名"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -p "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("指定宿主机端口"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("指定root登录密码"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  mysql:8.0.16\n")])])])]),s._v(" "),a("el-tab-pane",{attrs:{label:"示例"}},[a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("docker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f mysql-test\n\ndocker run            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -d                  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name mysql-test   "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  mysql:8.0.16\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d --name mysql-test -p 3306:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql:8.0.16")]),s._v("\n")])])])])],1),s._v(" "),a("ul",[a("li",[s._v("验证安装成功")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看容器的运行信息")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入 mysql-test 容器")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysql-test /bin/bash\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 执行 mysql-cli 的连接命令")]),s._v("\nmysql -uroot -p123456\n")])])]),a("ul",[a("li",[s._v("后续可选操作")])]),s._v(" "),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("对 root 的远程连接授权")]),s._v(" "),a("p",[s._v("容器逻辑上等价于另一台电脑。而在 mysql 中，root 用户默认只能从 MySQL Server 所在的电脑上登陆，无法从 “另一台” 电脑通过远程连接的方式登陆。")]),s._v(" "),a("p",[s._v("当然，这种 “默认” 行为是可以配置的。")]),s._v(" "),a("p",[s._v("按上述命令，从容器内部连接到 MySQL Server，执行如下 SQL 语句：")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" host "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("GRANT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ALL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("TO")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@'%'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flush "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("privileges")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])])]),s._v(" "),a("h2",{attrs:{id:"_2-配置与挂载"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置与挂载"}},[s._v("#")]),s._v(" 2. 配置与挂载")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("MySQL Server 的 “数据存储目录” 容器中的")]),s._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/var/lib/mysql\n")])])])]),s._v(" "),a("li",[a("p",[s._v("MySQL Server 的配置文件是容器中")])])]),s._v(" "),a("div",{staticClass:"language-text extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("/etc/mysql/my.cnf \n/etc/mysql/conf.d\n")])])]),a("details",{staticClass:"custom-block details"},[a("summary",[s._v("关于 MySQL 的配置文件和配置项")]),s._v(" "),a("p",[s._v("MySQL Server 启动时会去加载 "),a("code",[s._v("/etc/mysql")]),s._v(" 下的 my.cnf 配置文件，这个配置文件中有一部分配置。"),a("strong",[s._v("一般情况下我们即不会去动这部分内容，也不会在这个配置文件中追加内容")]),s._v(" 。")]),s._v(" "),a("p",[s._v("在 my.cnf 配置文件的最后，它又 include 了同一级目录下的 "),a("strong",[s._v("conf.d")]),s._v(" 目录，即，让 MySQL Server 再去加载 conf.d 目录下的所有的 .cnf 配置文件。")]),s._v(" "),a("p",[s._v("在 docker 中，默认情况下这个目录下有 2 个配置文件 docker.cnf 和 mysql.cnf"),a("small",[s._v("（其中，mysql.cnf 中除了注释基本啥都没有）")]),s._v("。")])]),s._v(" "),a("ul",[a("li",[s._v("示例")])]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 删除已存在的同名容器")]),s._v("\ndocker "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -f mysql-3306\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建并运行容器，docker 会自动创建 ~/docker/3306/data 目录")]),s._v("\ndocker run "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -d "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --name mysql-3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -v ~/docker/3306/data:/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v(":3306 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -e "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("123456")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  mysql:8.0.16\n")])])]),a("h2",{attrs:{id:"_3-docker-compse-方式启动"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-docker-compse-方式启动"}},[s._v("#")]),s._v(" 3. docker-compse 方式启动")]),s._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("services")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mysql-3306")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8.0.16\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("network_mode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bridge"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 默认值。常见的还有 host ")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mem_limit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 512m "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 限定 docker 容器内存大小")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" MYSQL_ROOT_PASSWORD=123456\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" /etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/etc/localtime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("ro  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时区")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ~/docker/3306/data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("/var/lib/mysql "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 数据")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# network_mode: "host" 无需端口映射')]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"3306:3306"')]),s._v("\n")])])]),a("p",[s._v("启动命令："),a("strong",[s._v("docker-compose up -d mysql-3306")])]),s._v(" "),a("h2",{attrs:{id:"_4-初始化数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-初始化数据库"}},[s._v("#")]),s._v(" 4. 初始化数据库")]),s._v(" "),a("p",[s._v("mysql 的 docker 镜像有一个功能：它在第一次创建并启动容器"),a("small",[s._v("（注意，重启不算）")]),s._v("时，会到容器内的 "),a("code",[s._v("/docker-entrypoint-initdb.d")]),s._v(" 目录下查看有没有 sql 脚本"),a("small",[s._v("（ .sql 文件 ）")]),s._v("。如果有，就执行 sql 脚本。因此，你可以通过这个功能来完成数据库的创建等初始化工作。")]),s._v(" "),a("p",[s._v("你可以在某个目录下创建 .sql 脚本"),a("small",[s._v("（例如 init.sql）")]),s._v("，并在其中写上建库、建表等 SQL 语句，然后将这个目录映射成 "),a("code",[s._v("/docker-entrypoint-initdb.d")]),s._v(" 。")]),s._v(" "),a("p",[s._v("更进一步，你可以使用 Dockerfile 将你的建库建表脚本和 docker-mysql 打成一个新的镜像。")])],1)}),[],!1,null,null,null);t.default=n.exports}}]);